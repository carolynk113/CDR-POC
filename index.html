<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CDR POC - Add Dog</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>CDR Proof of Concept</h1>

  <div id="auth-section">
    <input type="email" id="email" placeholder="Enter your email">
    <button id="login-btn">Send Magic Link</button>
  </div>

  <div id="app-section" style="display:none;">
    <p id="user-info"></p>
    <h2>Add a Dog</h2>
    <form id="dog-form">
      <input type="text" id="dog-name" placeholder="Registered Name" required>
      <select id="dog-sex" required>
        <option value="">Select Sex</option>
        <option value="M">Male</option>
        <option value="F">Female</option>
      </select>
      <input type="date" id="dog-dob" required>
      <button type="submit">Save Dog</button>
    </form>
    <h2>Your Dogs</h2>
    <ul id="dog-list"></ul>
  </div>

  <script>
    const sb = supabase.createClient(
      "https://brmqfmnnyxbfzutlhgzz.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJybXFmbW5ueXhiZnp1dGxoZ3p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MjcxMDYsImV4cCI6MjA3MDQwMzEwNn0.FmkPloBzTbfLfs6vlqSerSqn51LOonNX7PVsdUB3tQI"
    );

    // When returning from magic link, exchange code for a session
    (async () => {
      const url = new URL(window.location.href);
      const code = url.searchParams.get('code');
      if (code) {
        const { error } = await sb.auth.exchangeCodeForSession({ code });
        if (error) console.error('exchangeCodeForSession:', error.message);
        // Clean up URL
        window.history.replaceState({}, document.title, url.origin + url.pathname);
      }
    })();
<script>
// replace your current click handler with this
document.getElementById('login-btn').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  console.log('[auth] sending OTP to', email);
  try {
    const { data, error } = await sb.auth.signInWithOtp({
      email,
      options: { emailRedirectTo: window.location.origin }
    });
    console.log('[auth] result', { data, error });
    alert(error ? `ERROR: ${error.message}` : 'Magic link sent! Check your email.');
  } catch (e) {
    console.error(e);
    alert(`ERROR: ${e.message}`);
  }
});
</script>
  
    sb.auth.onAuthStateChange(() => refreshUI());

    async function refreshUI() {
      const { data: { user } } = await sb.auth.getUser();
      if (user) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('app-section').style.display = 'block';
        document.getElementById('user-info').textContent = `Signed in as ${user.email}`;
        loadDogs();
      } else {
        document.getElementById('auth-section').style.display = 'block';
        document.getElementById('app-section').style.display = 'none';
